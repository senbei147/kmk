<!DOCTYPE html><html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>åˆå”±ãƒ‘ãƒ¼ãƒˆãƒŸã‚­ã‚µãƒ¼ï¼ˆè¤‡æ•°æ›²å¯¾å¿œï¼‰</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; font-size: 18px; }
    h1 { margin-bottom: 20px; font-size: 28px; }
    h2 { font-size: 24px; margin-bottom: 10px; }
    #status { font-weight: bold; color: red; margin-left: 10px; font-size: 20px; }
    .card { background: #fff; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); padding: 20px; margin-bottom: 25px; }
    .track { display: flex; align-items: center; margin: 15px 0; }
    .track label { flex: 1; font-size: 20px; }
    input[type=range] {
      flex: 3;
      margin: 0 15px;
      height: 30px;
      -webkit-appearance: none;
      background: #ddd;
      border-radius: 15px;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #4285f4;
      cursor: pointer;
      box-shadow: 0 0 4px rgba(0,0,0,0.4);
    }
    input[type=range]::-moz-range-thumb {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #4285f4;
      cursor: pointer;
      box-shadow: 0 0 4px rgba(0,0,0,0.4);
    }
    button.mute { flex: 0; background: none; border: none; font-size: 28px; cursor: pointer; }
    button#playButton { font-size: 22px; padding: 10px 20px; border-radius: 8px; border: none; background: #4285f4; color: white; cursor: pointer; }
    .tabs { margin-bottom: 20px; }
    .tab-btn { font-size: 20px; padding: 10px 20px; margin-right: 10px; border: none; border-radius: 8px; cursor: pointer; background: #ccc; }
    .tab-btn.active { background: #4285f4; color: white; }
  </style>
</head>
<body>
  <h1>åˆå”±ãƒ‘ãƒ¼ãƒˆãƒŸã‚­ã‚µãƒ¼</h1>  <div class="tabs">
    <button class="tab-btn active" data-song="song1">è¼ãå¾¡å›½</button>
    <button class="tab-btn" data-song="song2">æ„Ÿè¬ã—ã¾ã™</button>
  </div><button id="playButton">å†ç”Ÿ / åœæ­¢</button><span id="status"></span>

  <div id="mixer">
    <div class="card">
      <h2>Soprano</h2>
      <div class="track">
        <label>Voice</label>
        <input type="range" id="soprano_Volume" min="0" max="1" step="0.01" value="1">
        <button class="mute" id="soprano_Mute">ğŸ”Š</button>
      </div>
    </div><div class="card">
  <h2>Alto</h2>
  <div class="track">
    <label>Voice</label>
    <input type="range" id="alto_Volume" min="0" max="1" step="0.01" value="1">
    <button class="mute" id="alto_Mute">ğŸ”Š</button>
  </div>
</div>

<div class="card">
  <h2>Tenor</h2>
  <div class="track">
    <label>Voice</label>
    <input type="range" id="tenor_Volume" min="0" max="1" step="0.01" value="1">
    <button class="mute" id="tenor_Mute">ğŸ”Š</button>
  </div>
</div>

  </div>  <script>
    const fileSets = {
      song1: {
        soprano: 'soprano1.mp3',
        alto: 'alto1.mp3',
        tenor: 'tenor1.mp3'
      },
      song2: {
        soprano: 'soprano2.mp3',
        alto: 'alto2.mp3',
        tenor: 'tenor2.mp3'
      }
    };

    let currentSong = 'song1';
    let audioCtx;
    let sources = {};
    let gains = {};
    let buffers = {};
    let isPlaying = false;
    let savedVolumes = {};

    async function loadFiles(song) {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      buffers = {};
      for (let part in fileSets[song]) {
        const response = await fetch(fileSets[song][part]);
        const arrayBuffer = await response.arrayBuffer();
        buffers[part] = await audioCtx.decodeAudioData(arrayBuffer);
      }
    }

    function createSources() {
      for (let part in buffers) {
        const source = audioCtx.createBufferSource();
        source.buffer = buffers[part];
        source.loop = true;

        const gainNode = audioCtx.createGain();
        gainNode.gain.value = document.getElementById(part + '_Volume').value;

        source.connect(gainNode).connect(audioCtx.destination);

        sources[part] = source;
        gains[part] = gainNode;
      }
    }

    function startAll() {
      createSources();
      const now = audioCtx.currentTime;
      for (let part in sources) {
        sources[part].start(now);
      }
      isPlaying = true;
      document.getElementById('status').textContent = 'â— å†ç”Ÿä¸­';
    }

    function stopAll() {
      for (let part in sources) {
        if (sources[part]) sources[part].stop();
      }
      sources = {};
      isPlaying = false;
      document.getElementById('status').textContent = '';
    }

    // å†ç”Ÿãƒœã‚¿ãƒ³
    document.getElementById('playButton').addEventListener('click', async () => {
      if (!buffers.soprano) await loadFiles(currentSong);
      if (!isPlaying) {
        startAll();
      } else {
        stopAll();
      }
    });

    // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨ãƒŸãƒ¥ãƒ¼ãƒˆå‡¦ç†
    Object.keys(fileSets.song1).forEach(part => {
      const slider = document.getElementById(part + '_Volume');
      const muteBtn = document.getElementById(part + '_Mute');
      
      slider.addEventListener('input', (e) => {
        if (gains[part]) gains[part].gain.value = e.target.value;
        savedVolumes[part] = e.target.value;
      });

      muteBtn.addEventListener('click', () => {
        if (gains[part]) {
          if (gains[part].gain.value > 0) {
            savedVolumes[part] = slider.value;
            gains[part].gain.value = 0;
            slider.value = 0;
            muteBtn.textContent = 'ğŸ”‡';
          } else {
            gains[part].gain.value = savedVolumes[part] || 1;
            slider.value = savedVolumes[part] || 1;
            muteBtn.textContent = 'ğŸ”Š';
          }
        }
      });
    });

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        if (btn.dataset.song === currentSong) return;

        // å†ç”Ÿä¸­ãªã‚‰æ­¢ã‚ã‚‹
        if (isPlaying) stopAll();

        // ã‚¿ãƒ–ã®è¦‹ãŸç›®åˆ‡ã‚Šæ›¿ãˆ
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        currentSong = btn.dataset.song;
        buffers = {}; // æ–°ã—ã„æ›²ã®ãƒãƒƒãƒ•ã‚¡ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æº–å‚™
      });
    });
  </script></body>
        </html>
